#!/usr/bin/env node
var os = require('os')
var exec = require('child_process').exec
var program = require('commander')
var wept = require('../index')
var json = require('../package.json')
var fs = require('fs')
var chalk = require('chalk')

process.on('uncaughtException', function(err) {
  console.log(chalk.red(err.stack))
  process.exit()
})

program.version(json.version + ' 101400')
  .usage('[app root]')
  .option('-o, --open', 'Open Chrome with for debugg, only works for MacOS')
  .option('-p, --port <n>', 'Set port of server, default 3000', parseInt)

program.parse(process.argv)

var port = program.port || 3000

var folder = program.args[0]
if (!folder) {
  folder = process.cwd()
}

if (os.platform() == 'darwin' && program.open) {
  exec('osascript chrome.scpt ' + port, {cwd: __dirname}, function (err) {
   //ignore error 
  })
}

wept(folder, program)

